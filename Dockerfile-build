# syntax=docker/dockerfile:1

# Build stage uses a prebuilt base image:
#   - Node.js 22
#   - Python 3.12
#   - uv
#
# The base image reference is configurable so CI can point it at the
# same registry/repository it pushes to.
ARG BASE_IMAGE=ghcr.io/estom/hexo-blog:base-v1.0.0
FROM ${BASE_IMAGE} AS build

WORKDIR /app

COPY . .
# 构建并删除中间文件，因为此模式要输出build镜像，所以降低基础镜像的大小
RUN bash ./build.sh && \
    rm -rf "$NOTES_DIR" && \
    rm -rf ".venv" && \
    rm -rf node_modules